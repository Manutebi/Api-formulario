<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">

    <title>Formulario2</title>
</head>
<body>
    <div class="container mt-5">
        <h3 class="text-center mb-4">Formulario</h3>
        <form id="product-form" class="row g-3">
            <div class="col-md-6">
                <label for="nombre" class="form-label">Nombre:</label>
                <input type="text" id="nombre" name="Nombre" class="form-control">
            </div>
            <div class="col-md-6">
                <label for="descripcion" class="form-label">Descripción:</label>
                <input type="text" id="descripcion" name="Descripcion" class="form-control">
            </div>
            <div class="col-md-6">
                <label for="precio" class="form-label">Precio:</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" id="precio" name="Precio" class="form-control">
                </div>
            </div>

            <div class="col-md-6">
                <label for="opciones" class="form-label">Opciones:</label>
                <select id="Opciones" class="form-control">
                </select>
            </div>
            
            <div class="col-md-6">
                <label for="table2" class="form-label">Table2:</label>
                <input type="text" id="table2" name="table2" class="form-control">
            </div>
            <div class="col-md-6">
                <label for="name" class="form-label">Name:</label>
                <input type="text" id="name" name="name" class="form-control">
            </div>

            <div class="col-md-6">
                <label for="name2" class="form-label">Name2:</label>
                <input type="text" id="name2" name="name2" class="form-control">
            </div>

            <div class="col-md-6">
                <label for="notes" class="form-label">Notes:</label>
                <input type="text" id="notes" name="notes" class="form-control">
            </div>

            <div class="col-md-6">
                <label for="assignee" class="form-label">Assignee:</label>
                <input type="text" id="assignee" name="assignee" class="form-control">
            </div>

            <div class="col-md-6">
                <label for="status" class="form-label">Status:</label>
                <input type="text" id="status" name="status" class="form-control">
            </div>

            <div class="col-12">
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>

        
        </form>
    </div>

    <script>
        // Obtener el valor del parámetro "ID" de la URL de la página actual
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const ID = urlParams.get("ID");

        fetch(`https://api.airtable.com/v0/appU7lYsFSoNH4hGO/Productos/${ID}`, {
            headers: {
                Authorization: "Bearer keykY5YjFxN23izT6"
            }
        })
        .then(response => response.json())
        .then(data => {
            // Establecer los valores de los campos del formulario
            document.getElementById("nombre").value = data.fields.Nombre;
            document.getElementById("descripcion").value = data.fields.Descripcion;
            document.getElementById("precio").value = data.fields.Precio;
            document.getElementById("name").value = data.fields.Name;
            document.getElementById("table2").value = data.fields.Table2;

            // Obtener el ID de la fila de la tabla table_2
            const table2ID = data.fields.Table2[0];

            // Hacer una solicitud a Airtable para obtener los datos de la fila de la tabla table_2
            fetch(`https://api.airtable.com/v0/appU7lYsFSoNH4hGO/table_2/${table2ID}`, {
                headers: {
                    Authorization: "Bearer keykY5YjFxN23izT6"
                }
            })
            .then(response => response.json())
            .then(data => {
                // Establecer los valores de los campos del formulario
                document.getElementById("name2").value = data.fields.Name2;
                document.getElementById("notes").value = data.fields.Notes;
                document.getElementById("assignee").value = data.fields.Assignee.name;
                document.getElementById("status").value = data.fields.Status;
            })
            .catch(error => {
                console.error(error);
            });

        })
        .catch(error => {
            console.error(error);
        });


            

        fetch(`https://api.airtable.com/v0/appU7lYsFSoNH4hGO/Productos/${ID}`, {
        headers: {
                Authorization: "Bearer keykY5YjFxN23izT6"
            }
        })
        .then(response => response.json())
        .then(data => {
            const selectElement = document.getElementById("Opciones");
            const currentOption = data.fields.Opciones;
            const optionElement = document.createElement("option");
            optionElement.value = currentOption;
            optionElement.textContent = currentOption;
            if (currentOption === data.fields.Opciones) {
                optionElement.selected = true;
            }
            selectElement.appendChild(optionElement);
        })
        .catch(error => {
            console.error(error);
        });

        // Obtener el formulario
const form = document.getElementById("product-form");

// Agregar un listener al evento "submit" del formulario
form.addEventListener("submit", event => {
    event.preventDefault();

    // Obtener los valores de los campos del formulario
    const nombre = document.getElementById("nombre").value;
    const descripcion = document.getElementById("descripcion").value;
    const precio = parseFloat(document.getElementById('precio').value);
    const opciones = document.getElementById("Opciones").value;
    const name =  document.getElementById("name").value;
    const table2 = document.getElementById("table2").value;
    const name2 = document.getElementById("name2").value;
    const notes = document.getElementById("notes").value;
    const assignee = document.getElementById("assignee").value;
    const status = document.getElementById("status").value;

    // Crear un objeto con los nuevos datos a actualizar en la base de datos
    const newData = {
        fields: {
            Nombre: nombre,
            Descripcion: descripcion,
            Precio: precio,
            Opciones: opciones,
            Name: name,
            Table2: table2,
            "table_2.Name2": name2,
            "table_2.Notes": notes,
            "table_2.Assignee": assignee,
            "table_2.Status": status
        }
    };

    // Realizar una solicitud a la API de Airtable para actualizar los datos en la base de datos
    fetch(`https://api.airtable.com/v0/appU7lYsFSoNH4hGO/Productos/${ID}`, {
        method: "PATCH",
        headers: {
            Authorization: "Bearer keykY5YjFxN23izT6",
            "Content-Type": "application/json"
        },
        body: JSON.stringify(newData)
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        alert("Los datos se han actualizado correctamente.");
    })
    .catch(error => {
        console.error(error);
        alert("Ha ocurrido un error al actualizar los datos.");
    });
});




    </script>
</body>
</html>
